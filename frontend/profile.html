<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - RecipeVault</title>
    <link rel="stylesheet" href="profile.css">
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <script>
    if (sessionStorage.getItem('log') !== 'true') {
    alert('You must log in to access this page.');
    window.location.href = 'index.html';
}
</script>

    <!-- chatbot -->
 <script>
(function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="s8qefyk4CnxUP4DK0k1YX";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
</script>

    <!-- Header Section -->
    <header>
        <div class="container">
            <h1>RecipeVault</h1>
            <nav>
                <ul>
                    <li><a href="categories.html">Home</a></li>
                    <li><a href="profile.html" class="active">Profile</a></li>
                    <li><a href="#" onclick="logout()">Logout</a></li>

                </ul>
            </nav>
        </div>
    </header>

    <!-- Profile Content -->
    <main>
        <div class="container">
            <!-- Profile Header with Image and Username -->
            <div class="profile-header">
                <!-- <div class="profile-img-container"> -->
                    <!-- <img src="profile.jpg" alt="Profile Picture" class="profile-img"> -->
                <!-- </div> -->
                
            
                <img src="profile.jpg" alt="Profile Picture" class="profile-img" id="profile-img">
                <div class="username" id="username">@username</div>
            </div>
            

            <!-- Profile Details -->
            <div class="profile-details">
                <div class="detail-item">
                    <i class="fas fa-envelope"></i>
                    <strong>Email Address:</strong> <span id="user-email">user@example.com</span> <span class="verified">[Verified]</span>
                </div>

                <!-- Editable Bio Section with Pencil Icon -->
                <div class="detail-item bio">
                    <i class="fas fa-info-circle"></i>
                    <strong>Bio/Description:</strong>
                    <span class="bio-text" id="bio-text">A short introduction about me...</span>
                    <i class="fas fa-pencil-alt edit-icon" onclick="editBio()"></i>
                </div>

                <!-- Dietary Preference Section -->
                <div class="detail-item">
                    <i class="fas fa-leaf"></i>
                    <strong>Dietary Preference:</strong>
                    <select class="dietary-select" id="dietary-select">
                        <option value="vegetarian">Vegetarian</option>
                        <option value="non-vegetarian">Non-Vegetarian</option>
                    </select>
                </div>

                <!-- Cooking Skill Level -->
                <div class="detail-item">
                    <i class="fas fa-utensils"></i>
                    <strong>Cooking Skill Level:</strong>
                    <select class="skill-select" id="skill-select">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>

                <!-- Saved Recipes Count -->
                <div class="detail-item">
                    <i class="fas fa-bookmark"></i>
                    <strong>Saved Recipes:</strong>
                    <span class="saved-count" id="saved-count">0</span> <!-- You can make this dynamic later -->
                </div>

                <!-- Account Settings (Update & Delete on same line) -->
                <div class="detail-item action-buttons">
                    <button class="edit-btn" onclick="updatePreferences()">Update Account</button>
                    <button class="delete-btn" onclick="deleteAccount()">Delete Account</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2025 RecipeVault. All rights reserved.</p>
    </footer>

    <script>
        // Function to enable editing the Bio section
        function editBio() {
            // Change the bio text to an editable textarea
            const bioText = document.querySelector('#bio-text');
            const bioField = document.createElement('textarea');
            bioField.classList.add('editable');
            bioField.value = bioText.innerText;
        
            bioText.replaceWith(bioField);
        
            // Replace pencil icon with a save icon
            const pencilIcon = document.querySelector('.edit-icon');
            pencilIcon.classList.remove('fa-pencil-alt');
            pencilIcon.classList.add('fa-save');
            pencilIcon.setAttribute('onclick', 'saveBio()');
        }
        
        // Function to save the edited Bio
        function saveBio() {
            const bioField = document.querySelector('.editable');
            const bioText = document.createElement('span');
            bioText.classList.add('bio-text');
            bioText.innerText = bioField.value;
        
            bioField.replaceWith(bioText);
        
            // Replace save icon with a pencil icon
            const saveIcon = document.querySelector('.edit-icon');
            saveIcon.classList.remove('fa-save');
            saveIcon.classList.add('fa-pencil-alt');
            saveIcon.setAttribute('onclick', 'editBio()');
        }

        function updatePreferences() {
            const email = localStorage.getItem("email");
            const bio = document.querySelector('.bio-text')?.innerText || '';
            const dietaryPreference = document.getElementById("dietary-select").value;
            const cookingLevel = document.getElementById("skill-select").value;

            if (!email) {
                alert('You must be logged in to update your preferences.');
                return;
            }

            // Send updated data to the server for dietary preference
            fetch('/update-dietary', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, preference: dietaryPreference })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Dietary preference updated successfully') {
                     showAlert("Dietary preference updated", 1000);
                }
            })
            .catch(error => console.error('Error updating dietary preference:', error));

        fetch('/update-bio', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, bio }) 
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Bio updated successfully') {
            alert('Bio updated!');
        }
    })
    .catch(error => console.error('Error updating Bio:', error));

            // Send updated data to the server for cooking level
            fetch('/update-skill', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, skill: cookingLevel })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Cooking skill updated successfully') {
                    alert('Cooking skill updated!');
                }
            })
            .catch(error => console.error('Error updating cooking skill:', error));
        }

        function deleteAccount() {
            const email = localStorage.getItem('email');
            if (!email) {
                alert('You must be logged in to delete your account.');
                return;
            }

            const confirmDelete = confirm('Are you sure you want to delete your account? This action cannot be undone.');

            if (confirmDelete) {
                fetch('/delete-account', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Account deleted successfully') {
                        alert('Account deleted!');
                        window.location.href = 'index.html'; // Redirect to login page
                    }
                })
                .catch(error => console.error('Error deleting account:', error));
            }
        }

        // Fetch profile data (this should be done when the page loads)
        document.addEventListener('DOMContentLoaded', () => {
            const email = localStorage.getItem("email");
            if (email) {
                fetch(`/profile-data?email=${email}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('username').innerText = data.username;
                        document.getElementById('user-email').innerText = data.email;
                        document.getElementById('bio-text').innerText = data.bio || 'No bio available';
                        document.getElementById('dietary-select').value = data.dietary_preference || 'vegetarian';
                        document.getElementById('skill-select').value = data.cooking_level || 'beginner';
                    })
                    .catch(error => console.error('Error fetching profile data:', error));
            }
        });

        function logout() {
        localStorage.removeItem('email');
        window.location.href = 'index.html';
}
document.addEventListener("DOMContentLoaded", () => {
  const userEmail = localStorage.getItem('email');

  if (!userEmail) {
    console.error('User email not found in localStorage');
    document.getElementById('saved-count').textContent = '0';
    return;
  }

  fetch('/get-fav-count', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ email: userEmail })
  })
  .then(res => {
    if (!res.ok) {
      throw new Error('Network response was not ok');
    }
    return res.json();
  })
  .then(data => {
    if (data.success) {
      document.getElementById('saved-count').textContent = data.count;
    } else {
      document.getElementById('saved-count').textContent = '0';
      console.error('Failed to get saved recipe count');
    }
  })
  .catch(err => {
    console.error('Fetch error:', err);
    document.getElementById('saved-count').textContent = '0';
  });
});
    </script>

</body>
</html>
